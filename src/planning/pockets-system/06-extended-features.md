# Extended Features - Pockets System

## Overview

Dokumen ini mencakup 3 fitur tambahan yang memperluas fungsionalitas Pockets System:

1. **Carry Over per Kantong** - Automatic carryover dengan tracking source
2. **Archive/Delete Kantong** - Pengelolaan lifecycle kantong custom
3. **Wishlist & Budget Simulation** - Planning pembelian dan simulasi budget

---

# FEATURE 1: CARRY OVER PER KANTONG

## Concept

### Problem Statement
Saat ini carry over hanya di level budget awal (kantong sehari-hari). User perlu carry over untuk SEMUA kantong agar tracking multi-bulan lebih akurat.

### Solution
Automatic carry over untuk setiap kantong di akhir bulan, dengan tracking lengkap dari mana saldo berasal.

---

## User Stories

### Story 1: Automatic Carry Over
```
AS A user
I WANT saldo kantong otomatis carry over ke bulan berikutnya
SO THAT saya tidak perlu manual input carry over tiap bulan
```

**Acceptance Criteria**:
- âœ… Saat pindah ke bulan baru, saldo akhir bulan lalu otomatis jadi carry over
- âœ… Carry over muncul sebagai entry pertama di timeline bulan baru
- âœ… Breakdown menunjukkan asal saldo (original vs spent)

### Story 2: Carry Over Tracking
```
AS A user
I WANT tahu dari mana carry over saya berasal
SO THAT saya bisa track uang dari bulan lalu vs bulan ini
```

**Acceptance Criteria**:
- âœ… Timeline menunjukkan carry over sebagai income entry
- âœ… Tooltip/detail menunjukkan breakdown: original balance, spent, remaining
- âœ… Bisa klik untuk lihat detail bulan sebelumnya

---

## Data Structure

### TypeScript Interfaces

```typescript
/**
 * Carry Over Entry
 * Represents balance carried from previous month
 */
interface CarryOverEntry {
  id: string;
  pocketId: string;
  fromMonth: string;        // '2025-10'
  toMonth: string;          // '2025-11'
  amount: number;           // Total carried over
  
  breakdown: {
    originalBalance: number;    // Starting balance bulan lalu
    income: number;            // Total income bulan lalu
    expenses: number;          // Total expenses bulan lalu
    transferIn: number;        // Total transfer masuk bulan lalu
    transferOut: number;       // Total transfer keluar bulan lalu
    finalBalance: number;      // = amount (for verification)
  };
  
  createdAt: string;        // ISO date
  autoGenerated: boolean;   // true = auto, false = manual
}

/**
 * Carry Over Summary (for display)
 */
interface CarryOverSummary {
  monthKey: string;
  pockets: Array<{
    pocketId: string;
    pocketName: string;
    carryOverAmount: number;
    hasCarryOver: boolean;
    fromMonth: string;
  }>;
  totalCarryOver: number;
}
```

### Database Schema

```typescript
// KV Store Keys
`carryovers:${monthKey}` â†’ CarryOverEntry[]

// Example:
{
  "carryovers:2025-11": [
    {
      id: "carryover_2025-11_pocket_daily",
      pocketId: "pocket_daily",
      fromMonth: "2025-10",
      toMonth: "2025-11",
      amount: 3500000,
      breakdown: {
        originalBalance: 8000000,    // Budget awal Okt
        income: 0,                   // No additional income
        expenses: 4500000,           // Total pengeluaran Okt
        transferIn: 0,
        transferOut: 0,
        finalBalance: 3500000        // Rp 8jt - Rp 4.5jt
      },
      createdAt: "2025-11-01T00:00:00Z",
      autoGenerated: true
    },
    {
      id: "carryover_2025-11_pocket_cold_money",
      pocketId: "pocket_cold_money",
      fromMonth: "2025-10",
      toMonth: "2025-11",
      amount: 1500000,
      breakdown: {
        originalBalance: 2000000,    // Pemasukan tambahan Okt
        income: 0,
        expenses: 500000,
        transferIn: 0,
        transferOut: 0,
        finalBalance: 1500000
      },
      createdAt: "2025-11-01T00:00:00Z",
      autoGenerated: true
    }
  ]
}
```

---

## Implementation Logic

### Auto-Generate Carry Over

```typescript
/**
 * Generate carry overs for new month
 * Called when user first accesses a new month
 */
async function generateCarryOvers(
  fromMonth: string,
  toMonth: string
): Promise<CarryOverEntry[]> {
  // Get all pockets from previous month
  const pockets = await getPockets(fromMonth);
  const carryOvers: CarryOverEntry[] = [];
  
  for (const pocket of pockets) {
    // Calculate final balance of previous month
    const balance = await calculatePocketBalance(pocket.id, fromMonth);
    
    // Only create carry over if balance > 0
    if (balance.availableBalance > 0) {
      const carryOver: CarryOverEntry = {
        id: `carryover_${toMonth}_${pocket.id}`,
        pocketId: pocket.id,
        fromMonth,
        toMonth,
        amount: balance.availableBalance,
        breakdown: {
          originalBalance: balance.originalAmount,
          income: 0, // Will be detailed in timeline
          expenses: balance.expenses,
          transferIn: balance.transferIn,
          transferOut: balance.transferOut,
          finalBalance: balance.availableBalance
        },
        createdAt: new Date().toISOString(),
        autoGenerated: true
      };
      
      carryOvers.push(carryOver);
    }
  }
  
  // Save to KV store
  await kv.set(`carryovers:${toMonth}`, carryOvers);
  
  return carryOvers;
}

/**
 * Get or generate carry overs for a month
 */
async function getCarryOvers(monthKey: string): Promise<CarryOverEntry[]> {
  // Check if already exists
  let carryOvers = await kv.get<CarryOverEntry[]>(`carryovers:${monthKey}`);
  
  if (!carryOvers || carryOvers.length === 0) {
    // Auto-generate from previous month
    const prevMonth = getPreviousMonth(monthKey);
    const prevMonthData = await kv.get(`budget:${prevMonth}`);
    
    // Only generate if previous month has data
    if (prevMonthData) {
      carryOvers = await generateCarryOvers(prevMonth, monthKey);
    } else {
      carryOvers = [];
    }
  }
  
  return carryOvers;
}
```

### Modified Balance Calculation

```typescript
/**
 * Calculate pocket balance including carry over
 */
async function calculatePocketBalance(
  pocketId: string,
  monthKey: string
): Promise<PocketBalance> {
  // Get carry over for this pocket
  const carryOvers = await getCarryOvers(monthKey);
  const carryOver = carryOvers.find(co => co.pocketId === pocketId);
  
  // Original amount now includes carry over
  let originalAmount = 0;
  
  // Add carry over
  if (carryOver) {
    originalAmount += carryOver.amount;
  }
  
  // Add this month's income
  if (pocketId === POCKET_IDS.DAILY) {
    const budget = await kv.get<BudgetData>(`budget:${monthKey}`) || {};
    originalAmount += (budget.initialBudget || 0);
    // Note: budget.carryover is deprecated with this system
  } else if (pocketId === POCKET_IDS.COLD_MONEY) {
    const income = await kv.get<AdditionalIncome[]>(`additional_income:${monthKey}`) || [];
    const excludedIds = new Set(await kv.get<string[]>(`excluded_income_ids:${monthKey}`) || []);
    originalAmount += income
      .filter(i => !excludedIds.has(i.id))
      .reduce((sum, i) => sum + i.amountIDR - i.deduction, 0);
  }
  
  // Calculate transfers and expenses (same as before)
  const transfers = await kv.get<TransferTransaction[]>(`transfers:${monthKey}`) || [];
  const expenses = await kv.get<Expense[]>(`expenses:${monthKey}`) || [];
  const excludedExpenseIds = new Set(await kv.get<string[]>(`excluded_expense_ids:${monthKey}`) || []);
  
  const transferIn = transfers
    .filter(t => t.toPocketId === pocketId)
    .reduce((sum, t) => sum + t.amount, 0);
    
  const transferOut = transfers
    .filter(t => t.fromPocketId === pocketId)
    .reduce((sum, t) => sum + t.amount, 0);
  
  const expensesTotal = expenses
    .filter(e => e.pocketId === pocketId && !excludedExpenseIds.has(e.id))
    .reduce((sum, e) => sum + e.amount, 0);
  
  const availableBalance = originalAmount + transferIn - transferOut - expensesTotal;
  
  return {
    pocketId,
    originalAmount,
    transferIn,
    transferOut,
    expenses: expensesTotal,
    availableBalance,
    lastUpdated: new Date().toISOString()
  };
}
```

### Timeline Integration

```typescript
/**
 * Generate timeline with carry over entry
 */
async function generatePocketTimeline(
  pocketId: string,
  monthKey: string,
  sortOrder: 'asc' | 'desc' = 'desc'
): Promise<TimelineEntry[]> {
  const entries: TimelineEntry[] = [];
  
  // 1. Add carry over entry FIRST
  const carryOvers = await getCarryOvers(monthKey);
  const carryOver = carryOvers.find(co => co.pocketId === pocketId);
  
  if (carryOver) {
    entries.push({
      id: carryOver.id,
      type: 'income',
      date: `${monthKey}-01T00:00:00Z`,
      description: `Carry Over dari ${formatMonth(carryOver.fromMonth)}`,
      amount: carryOver.amount,
      balanceAfter: 0,
      icon: 'TrendingUp',
      color: 'green',
      metadata: {
        carryOver: true,
        breakdown: carryOver.breakdown,
        fromMonth: carryOver.fromMonth
      }
    });
  }
  
  // 2. Add regular income entries
  // ... (existing code)
  
  // 3. Add expenses
  // ... (existing code)
  
  // 4. Add transfers
  // ... (existing code)
  
  // 5. Sort and calculate running balance
  // ... (existing code)
  
  return entries;
}
```

---

## UI/UX Design

### Timeline Display

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timeline Kantong Sehari-hari - November 2025      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ˆâ”‚ Carry Over dari Oktober    +Rp 3.500.000â”‚ â”‚
â”‚ â”‚   â”‚ 1 Nov 2025, 00:00                       â”‚ â”‚
â”‚ â”‚   â”‚                                         â”‚ â”‚
â”‚ â”‚   â”‚ â„¹ï¸  Detail:                             â”‚ â”‚
â”‚ â”‚   â”‚   â€¢ Budget Awal Okt: Rp 8.000.000      â”‚ â”‚
â”‚ â”‚   â”‚   â€¢ Pengeluaran Okt: -Rp 4.500.000     â”‚ â”‚
â”‚ â”‚   â”‚   â€¢ Sisa dibawa: Rp 3.500.000          â”‚ â”‚
â”‚ â”‚   â”‚                                         â”‚ â”‚
â”‚ â”‚   â”‚                    Saldo: Rp 3.500.000 â”‚ â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘›â”‚ Budget Awal                +Rp 8.000.000â”‚ â”‚
â”‚ â”‚   â”‚ 1 Nov 2025, 00:00:01                    â”‚ â”‚
â”‚ â”‚   â”‚                   Saldo: Rp 11.500.000 â”‚ â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ›â”‚ Groceries                   -Rp 350.000 â”‚ â”‚
â”‚ â”‚   â”‚ 2 Nov 2025, 14:30                       â”‚ â”‚
â”‚ â”‚   â”‚                   Saldo: Rp 11.150.000 â”‚ â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Carry Over Badge in Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘› Sehari-hari                          â”‚
â”‚ Budget untuk kebutuhan sehari-hari      â”‚
â”‚                                         â”‚
â”‚ Saldo Tersedia    Rp 11.150.000        â”‚
â”‚                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Saldo Bulan Ini                         â”‚
â”‚ Carry Over         +Rp 3.500.000 ğŸ”„    â”‚
â”‚ Budget Awal        +Rp 8.000.000       â”‚
â”‚ Pengeluaran        -Rp 350.000         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Carry Over Detail Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Detail Carry Over               [X]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Kantong: Sehari-hari                    â”‚
â”‚ Dari: Oktober 2025                      â”‚
â”‚ Ke: November 2025                       â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š Breakdown Oktober 2025:              â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Budget Awal       Rp 8.000.000     â”‚ â”‚
â”‚ â”‚ Pengeluaran      -Rp 4.500.000     â”‚ â”‚
â”‚ â”‚ Transfer In       Rp 0             â”‚ â”‚
â”‚ â”‚ Transfer Out      Rp 0             â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚ Saldo Akhir       Rp 3.500.000 âœ…  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ ğŸ”„ Carry Over ke November:              â”‚
â”‚ +Rp 3.500.000                          â”‚
â”‚                                         â”‚
â”‚ [Lihat Timeline Oktober]   [Tutup]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoints

```typescript
// GET carry overs for month
GET /carryover?monthKey=2025-11
Response: {
  success: true,
  data: {
    carryOvers: CarryOverEntry[],
    summary: CarryOverSummary
  }
}

// POST generate carry overs (manual trigger)
POST /carryover/generate
Body: {
  fromMonth: "2025-10",
  toMonth: "2025-11"
}
Response: {
  success: true,
  data: {
    generated: CarryOverEntry[]
  }
}

// GET carry over history for pocket
GET /carryover/history?pocketId=pocket_daily&limit=12
Response: {
  success: true,
  data: {
    history: Array<{
      month: string,
      amount: number,
      breakdown: {...}
    }>
  }
}

// PUT recalculate carry over (if past month changed)
PUT /carryover/recalculate?monthKey=2025-11
Response: {
  success: true,
  data: {
    updated: CarryOverEntry[]
  }
}
```

---

## Edge Cases & Handling

### Case 1: First Month (No Previous Data)
```
Behavior: No carry over entries generated
Timeline: Starts with Budget Awal / Pemasukan Tambahan
UI: No carry over badge
```

### Case 2: Previous Month Changed After Carry Over Generated
```
Scenario: User edits October data after November carry over exists

Solution:
1. Show warning: "âš ï¸ Perubahan akan mempengaruhi carry over bulan depan"
2. After save: "Recalculate carry over November?"
3. [Yes] â†’ Recalculate â†’ Update balance
4. [No] â†’ Keep current carry over (manual override)
```

### Case 3: Negative Balance Carry Over
```
Scenario: October ends with -Rp 500.000

Solution:
1. Still create carry over with negative amount
2. Timeline shows: "Carry Over (Defisit) -Rp 500.000" in RED
3. November starts with negative balance
4. UI warning: "âš ï¸ Bulan ini dimulai dengan defisit"
```

### Case 4: Pocket Archived Mid-Month
```
Scenario: User archives pocket in October, then November comes

Solution:
1. Do NOT generate carry over for archived pockets
2. If pocket was archived with balance = 0, no issue
3. If force-archived (shouldn't happen), no carry over
```

---

## Migration Strategy

### Existing Apps (Backward Compatibility)

```typescript
/**
 * Migrate old carryover system to new per-pocket system
 */
async function migrateOldCarryOver(monthKey: string) {
  const budget = await kv.get<BudgetData>(`budget:${monthKey}`);
  
  if (budget && budget.carryover && budget.carryover > 0) {
    // Old carryover exists in budget
    // Create manual carry over entry for pocket_daily
    const carryOver: CarryOverEntry = {
      id: `carryover_migrated_${monthKey}_pocket_daily`,
      pocketId: POCKET_IDS.DAILY,
      fromMonth: getPreviousMonth(monthKey),
      toMonth: monthKey,
      amount: budget.carryover,
      breakdown: {
        originalBalance: budget.carryover, // Unknown
        income: 0,
        expenses: 0,
        transferIn: 0,
        transferOut: 0,
        finalBalance: budget.carryover
      },
      createdAt: new Date().toISOString(),
      autoGenerated: false // Manual migration
    };
    
    const carryOvers = await getCarryOvers(monthKey);
    carryOvers.push(carryOver);
    await kv.set(`carryovers:${monthKey}`, carryOvers);
    
    // Mark budget.carryover as migrated (keep for reference)
    // budget.carryover will be ignored in new balance calculation
  }
}
```

---

# FEATURE 2: ARCHIVE / DELETE KANTONG

## Concept

### Problem Statement
Custom pockets (Phase 2) perlu bisa dihapus, tapi:
- Ada saldo tersisa
- Ada historical expenses yang reference pocket ini
- Ada transfer history

### Solution
**Soft Archive** dengan syarat balance = 0, plus option untuk return dana ke kantong lain.

---

## User Stories

### Story 1: Archive Empty Pocket
```
AS A user
I WANT to archive a pocket that is no longer needed
SO THAT my pocket list stays clean and relevant
```

**Acceptance Criteria**:
- âœ… Pocket dengan balance = 0 bisa diarchive
- âœ… Archived pocket tidak muncul di active list
- âœ… Historical expenses tetap valid (show archived badge)
- âœ… Bisa unarchive kapan saja

### Story 2: Return Funds Before Archive
```
AS A user
I WANT to return remaining balance before archiving
SO THAT no money is "lost" in archived pocket
```

**Acceptance Criteria**:
- âœ… Jika balance > 0, user HARUS transfer dulu
- âœ… Dialog menunjukkan balance dan pilihan kantong tujuan
- âœ… Option: Auto-distribute based on source history
- âœ… Option: Manual select target pocket
- âœ… After transfer complete, balance = 0, then archive

---

## Data Structure

```typescript
/**
 * Extended Pocket Interface
 */
interface Pocket {
  // ... existing fields
  status: 'active' | 'archived';
  archivedAt?: string;        // ISO date
  archivedReason?: string;    // User input
  
  // Source tracking (for auto-return calculation)
  sourceHistory?: Array<{
    fromPocketId: string;
    totalReceived: number;     // Total ever transferred from this source
    percentage: number;        // % of total transfers
  }>;
}

/**
 * Archive Request
 */
interface ArchiveRequest {
  pocketId: string;
  monthKey: string;            // Current month
  reason?: string;
  
  // Balance return strategy
  returnStrategy: 'auto' | 'manual' | 'split';
  
  // For manual/split
  returns?: Array<{
    toPocketId: string;
    amount: number;
  }>;
}

/**
 * Archive Result
 */
interface ArchiveResult {
  success: boolean;
  archivedPocket: Pocket;
  returnTransfers: TransferTransaction[];
  newBalances: Map<string, PocketBalance>;
}
```

### Database Schema

```typescript
// Active pockets (unchanged)
`pockets:${monthKey}` â†’ Pocket[]  // Only active pockets

// Archived pockets (global, not per month)
`archived_pockets:${userId}` â†’ Pocket[]

// Archive history (audit trail)
`archive_history:${userId}` â†’ Array<{
  pocketId: string,
  archivedAt: string,
  archivedBy: string, // userId
  reason: string,
  balanceAtArchive: number,
  returnTransfers: TransferTransaction[]
}>
```

---

## Implementation Logic

### Calculate Source History

```typescript
/**
 * Calculate where pocket balance came from
 * Used for auto-return distribution
 */
async function calculateSourceHistory(
  pocketId: string,
  userId: string
): Promise<Pocket['sourceHistory']> {
  // Get ALL transfers TO this pocket across all months
  const allMonths = await getAllMonthsForUser(userId);
  const sourceMap = new Map<string, number>();
  
  for (const monthKey of allMonths) {
    const transfers = await kv.get<TransferTransaction[]>(`transfers:${monthKey}`) || [];
    
    transfers
      .filter(t => t.toPocketId === pocketId)
      .forEach(t => {
        const current = sourceMap.get(t.fromPocketId) || 0;
        sourceMap.set(t.fromPocketId, current + t.amount);
      });
  }
  
  // Calculate total and percentages
  const totalReceived = Array.from(sourceMap.values()).reduce((sum, val) => sum + val, 0);
  
  const sourceHistory = Array.from(sourceMap.entries()).map(([fromPocketId, amount]) => ({
    fromPocketId,
    totalReceived: amount,
    percentage: (amount / totalReceived) * 100
  }));
  
  // Sort by percentage descending
  sourceHistory.sort((a, b) => b.percentage - a.percentage);
  
  return sourceHistory;
}
```

### Archive Pocket Flow

```typescript
/**
 * Archive pocket with automatic return
 */
async function archivePocket(request: ArchiveRequest): Promise<ArchiveResult> {
  const { pocketId, monthKey, reason, returnStrategy, returns } = request;
  
  // 1. Validate: Pocket exists and is active
  const pockets = await getPockets(monthKey);
  const pocket = pockets.find(p => p.id === pocketId);
  
  if (!pocket) {
    throw new Error('Pocket not found');
  }
  
  if (pocket.status === 'archived') {
    throw new Error('Pocket already archived');
  }
  
  if (pocket.type === 'primary') {
    throw new Error('Cannot archive primary pockets');
  }
  
  // 2. Check balance
  const balance = await calculatePocketBalance(pocketId, monthKey);
  
  if (balance.availableBalance !== 0) {
    throw new Error('Balance must be 0 before archiving. Current balance: ' + balance.availableBalance);
  }
  
  // 3. If balance was > 0, transfers should have been created already
  // This step is just validation
  
  // 4. Update pocket status
  pocket.status = 'archived';
  pocket.archivedAt = new Date().toISOString();
  pocket.archivedReason = reason;
  
  // 5. Remove from active pockets
  const activePockets = pockets.filter(p => p.id !== pocketId);
  await kv.set(`pockets:${monthKey}`, activePockets);
  
  // 6. Add to archived pockets
  const archived = await kv.get<Pocket[]>(`archived_pockets:${userId}`) || [];
  archived.push(pocket);
  await kv.set(`archived_pockets:${userId}`, archived);
  
  // 7. Log archive action
  const history = await kv.get<any[]>(`archive_history:${userId}`) || [];
  history.push({
    pocketId,
    archivedAt: pocket.archivedAt,
    archivedBy: userId,
    reason: reason || 'No reason provided',
    balanceAtArchive: balance.availableBalance,
    returnTransfers: [] // Transfers already created before this
  });
  await kv.set(`archive_history:${userId}`, history);
  
  return {
    success: true,
    archivedPocket: pocket,
    returnTransfers: [],
    newBalances: new Map()
  };
}

/**
 * Prepare archive with balance return
 * This creates transfers BEFORE actual archive
 */
async function prepareArchiveWithReturn(
  pocketId: string,
  monthKey: string,
  strategy: 'auto' | 'manual',
  manualReturns?: Array<{ toPocketId: string; amount: number }>
): Promise<TransferTransaction[]> {
  const balance = await calculatePocketBalance(pocketId, monthKey);
  
  if (balance.availableBalance <= 0) {
    return []; // Nothing to return
  }
  
  let returns: Array<{ toPocketId: string; amount: number }> = [];
  
  if (strategy === 'auto') {
    // Calculate auto-distribution based on source history
    const sourceHistory = await calculateSourceHistory(pocketId, userId);
    
    const remaining = balance.availableBalance;
    let distributed = 0;
    
    for (let i = 0; i < sourceHistory.length; i++) {
      const source = sourceHistory[i];
      
      // Last source gets the remainder (to handle rounding)
      const amount = i === sourceHistory.length - 1
        ? remaining - distributed
        : Math.floor(remaining * (source.percentage / 100));
      
      returns.push({
        toPocketId: source.fromPocketId,
        amount
      });
      
      distributed += amount;
    }
    
    // If no source history (no transfers in), return to primary pocket
    if (returns.length === 0) {
      returns.push({
        toPocketId: POCKET_IDS.DAILY,
        amount: balance.availableBalance
      });
    }
  } else {
    // Manual returns
    returns = manualReturns || [];
    
    // Validate total
    const total = returns.reduce((sum, r) => sum + r.amount, 0);
    if (total !== balance.availableBalance) {
      throw new Error(`Return total (${total}) must equal balance (${balance.availableBalance})`);
    }
  }
  
  // Create transfer transactions
  const transfers: TransferTransaction[] = [];
  
  for (const ret of returns) {
    const transfer = await createTransfer({
      monthKey,
      fromPocketId: pocketId,
      toPocketId: ret.toPocketId,
      amount: ret.amount,
      date: new Date().toISOString(),
      note: `Return balance before archiving pocket`
    });
    
    transfers.push(transfer);
  }
  
  return transfers;
}
```

### Unarchive Pocket

```typescript
/**
 * Restore archived pocket
 */
async function unarchivePocket(
  pocketId: string,
  monthKey: string,
  userId: string
): Promise<Pocket> {
  // 1. Get archived pocket
  const archived = await kv.get<Pocket[]>(`archived_pockets:${userId}`) || [];
  const pocket = archived.find(p => p.id === pocketId);
  
  if (!pocket) {
    throw new Error('Archived pocket not found');
  }
  
  // 2. Reset status
  pocket.status = 'active';
  delete pocket.archivedAt;
  delete pocket.archivedReason;
  
  // 3. Add back to active pockets
  const activePockets = await getPockets(monthKey);
  activePockets.push(pocket);
  
  // Sort by order
  activePockets.sort((a, b) => a.order - b.order);
  
  await kv.set(`pockets:${monthKey}`, activePockets);
  
  // 4. Remove from archived
  const remainingArchived = archived.filter(p => p.id !== pocketId);
  await kv.set(`archived_pockets:${userId}`, remainingArchived);
  
  return pocket;
}
```

---

## UI/UX Design

### Archive Dialog (Balance > 0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Archive Kantong                   [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Kantong: ğŸ® Kantong Gaming               â”‚
â”‚ Saldo Tersisa: Rp 1.500.000             â”‚
â”‚                                          â”‚
â”‚ âš ï¸  Saldo harus Rp 0 sebelum archive.    â”‚
â”‚    Kembalikan dana ke kantong lain?     â”‚
â”‚                                          â”‚
â”‚ Pilih Strategi:                          â”‚
â”‚                                          â”‚
â”‚ âšª Auto-distribute (Recommended)         â”‚
â”‚    Berdasarkan riwayat transfer         â”‚
â”‚    â€¢ Sehari-hari: Rp 1.050.000 (70%)   â”‚
â”‚    â€¢ Uang Dingin: Rp 450.000 (30%)     â”‚
â”‚                                          â”‚
â”‚ âšª Pilih Manual                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ Sehari-hari              â–¼â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚    Semua Rp 1.500.000 ke kantong ini   â”‚
â”‚                                          â”‚
â”‚ âšª Split Manual                           â”‚
â”‚    Sehari-hari: [1000000]              â”‚
â”‚    Uang Dingin: [500000]               â”‚
â”‚    Total: Rp 1.500.000 âœ…              â”‚
â”‚                                          â”‚
â”‚ Alasan Archive (opsional):               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Sudah tidak gaming lagi            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Batal]    [Transfer & Archive]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Archive Dialog (Balance = 0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Archive Kantong                   [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Kantong: ğŸ® Kantong Gaming               â”‚
â”‚ Saldo: Rp 0 âœ…                           â”‚
â”‚                                          â”‚
â”‚ â„¹ï¸  Pocket akan di-archive dan tidak     â”‚
â”‚    muncul di daftar aktif.              â”‚
â”‚                                          â”‚
â”‚ Catatan:                                 â”‚
â”‚ â€¢ Historical expenses tetap tersimpan   â”‚
â”‚ â€¢ Bisa di-restore kapan saja            â”‚
â”‚ â€¢ Timeline tetap bisa diakses           â”‚
â”‚                                          â”‚
â”‚ Alasan Archive (opsional):               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Sudah tidak gaming lagi            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Batal]               [Archive]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Archived Pockets Section

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Archived Pockets (2)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ® Kantong Gaming                      â”‚ â”‚
â”‚ â”‚ Archived: 15 Nov 2025                  â”‚ â”‚
â”‚ â”‚ Reason: Sudah tidak gaming lagi        â”‚ â”‚
â”‚ â”‚                                        â”‚ â”‚
â”‚ â”‚ [View History] [Restore] [Delete]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœˆï¸  Liburan Bali 2025                  â”‚ â”‚
â”‚ â”‚ Archived: 30 Jun 2025                  â”‚ â”‚
â”‚ â”‚ Reason: Liburan selesai                â”‚ â”‚
â”‚ â”‚                                        â”‚ â”‚
â”‚ â”‚ [View History] [Restore] [Delete]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Expense List with Archived Badge

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pengeluaran - November 2025                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ Gaming Console  [Gaming ğŸ”’]  -Rp 800.000   â”‚
â”‚ 10 Nov 2025                                â”‚
â”‚ [ğŸ‘ï¸] [Edit] ...                            â”‚
â”‚                                            â”‚
â”‚ Groceries  [Sehari-hari]  -Rp 350.000     â”‚
â”‚ 2 Nov 2025                                 â”‚
â”‚ [ğŸ‘ï¸] [Edit] ...                            â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ = Archived pocket badge
```

---

## API Endpoints

```typescript
// POST prepare archive (check & calculate returns)
POST /pocket/:id/prepare-archive
Body: {
  monthKey: string,
  strategy: 'auto' | 'manual',
  manualReturns?: Array<{toPocketId, amount}>
}
Response: {
  success: true,
  data: {
    currentBalance: number,
    canArchive: boolean,
    suggestedReturns: Array<{toPocketId, amount, percentage}>,
    estimatedTransfers: TransferTransaction[]
  }
}

// POST archive pocket (execute)
POST /pocket/:id/archive
Body: {
  monthKey: string,
  reason?: string,
  createReturns: boolean, // If true, create return transfers first
  returnStrategy: 'auto' | 'manual',
  returns?: Array<{toPocketId, amount}>
}
Response: {
  success: true,
  data: {
    archivedPocket: Pocket,
    returnTransfers: TransferTransaction[],
    newBalances: Map<string, PocketBalance>
  }
}

// POST unarchive pocket
POST /pocket/:id/unarchive
Body: {
  monthKey: string
}
Response: {
  success: true,
  data: {
    restoredPocket: Pocket
  }
}

// GET archived pockets
GET /pockets/archived
Response: {
  success: true,
  data: {
    archived: Pocket[]
  }
}

// DELETE permanently delete archived pocket
DELETE /pocket/:id/permanent
Query: { confirm: true }
Response: {
  success: true,
  data: {
    deletedId: string
  }
}
```

---

# FEATURE 3: WISHLIST & BUDGET SIMULATION

## Concept

### Problem Statement
User punya rencana pembelian tapi:
- Tidak tahu apakah budget cukup
- Tidak tahu impact ke budget jika beli
- Sulit prioritize multiple items
- Tidak ada tracking untuk "planned expenses"

### Solution
Wishlist per pocket dengan simulation engine yang menunjukkan "what-if" scenarios.

---

## User Stories

### Story 1: Add Item to Wishlist
```
AS A user
I WANT to add planned purchases to a wishlist
SO THAT I can track what I want to buy
```

**Acceptance Criteria**:
- âœ… Bisa add item dengan nama, harga, priority
- âœ… Item linked to specific pocket
- âœ… Support multiple items per pocket
- âœ… Can add URL/image for reference

### Story 2: View Budget Simulation
```
AS A user
I WANT to see simulation of my wishlist
SO THAT I know if I can afford items and what the impact is
```

**Acceptance Criteria**:
- âœ… Separate simulation view per pocket
- âœ… Shows current balance vs wishlist total
- âœ… Highlights affordable vs unaffordable items
- âœ… Shows balance after each purchase (cascading)
- âœ… Priority-based simulation

### Story 3: Convert Wishlist to Expense
```
AS A user
I WANT to mark wishlist item as "purchased"
SO THAT it automatically becomes an expense
```

**Acceptance Criteria**:
- âœ… One-click convert to expense
- âœ… Pre-fills expense form with wishlist data
- âœ… Removes from wishlist after purchase
- âœ… Links expense to original wishlist item (for tracking)

---

## Data Structure

```typescript
/**
 * Wishlist Item
 */
interface WishlistItem {
  id: string;
  pocketId: string;
  name: string;
  amount: number;
  priority: 1 | 2 | 3;          // 1=High, 2=Medium, 3=Low
  
  // Optional metadata
  description?: string;
  url?: string;                  // Product URL
  imageUrl?: string;             // Product image
  targetDate?: string;           // When planning to buy (ISO date)
  tags?: string[];               // ['gaming', 'electronics']
  
  // Status tracking
  status: 'planned' | 'saving' | 'ready' | 'purchased';
  purchasedAt?: string;          // ISO date
  purchasedExpenseId?: string;   // Link to expense
  
  // Metadata
  createdAt: string;
  updatedAt: string;
  notes?: string;
}

/**
 * Simulation Scenario
 */
interface SimulationScenario {
  itemId: string;
  itemName: string;
  amount: number;
  currentBalance: number;
  balanceAfter: number;
  status: 'affordable' | 'low-balance' | 'insufficient';
  blockedItems: string[];        // Items that become unaffordable
  warning?: string;
}

/**
 * Simulation Result
 */
interface SimulationResult {
  pocketId: string;
  pocketName: string;
  currentBalance: number;
  
  wishlist: {
    total: number;
    count: number;
    byPriority: {
      high: { count: number; total: number };
      medium: { count: number; total: number };
      low: { count: number; total: number };
    };
  };
  
  // Affordability analysis
  affordableNow: string[];       // Item IDs
  affordableSoon: Array<{        // Need small amount
    itemId: string;
    amountNeeded: number;
    estimatedWeeks: number;
  }>;
  notAffordable: string[];       // Item IDs
  
  // Priority-based scenarios
  scenarios: SimulationScenario[];
  
  // Recommendations
  recommendations: Array<{
    type: 'warning' | 'info' | 'suggestion';
    message: string;
    actionable: boolean;
    action?: {
      type: 'transfer' | 'save' | 'reprioritize';
      params: any;
    };
  }>;
}

/**
 * Savings Plan (generated from wishlist)
 */
interface SavingsPlan {
  itemId: string;
  itemName: string;
  targetAmount: number;
  currentAmount: number;
  amountNeeded: number;
  
  targetDate?: string;
  estimatedDate: string;         // Based on income patterns
  
  // Suggestions
  weeklyTransfer: number;
  monthlyTransfer: number;
  weeksNeeded: number;
  
  // Auto-transfer setup (optional)
  autoTransferEnabled: boolean;
  autoTransferRule?: AutoTransferRule;
}
```

### Database Schema

```typescript
// Wishlist per month per pocket
`wishlist:${monthKey}:${pocketId}` â†’ WishlistItem[]

// Global wishlist (across months) for long-term items
`wishlist:global:${userId}` â†’ WishlistItem[]

// Savings plans
`savings_plans:${userId}` â†’ SavingsPlan[]

// Simulation cache (optional, for performance)
`simulation_cache:${monthKey}:${pocketId}` â†’ SimulationResult
```

---

## Implementation Logic

### Calculate Simulation

```typescript
/**
 * Generate simulation for pocket wishlist
 */
async function simulateWishlist(
  pocketId: string,
  monthKey: string
): Promise<SimulationResult> {
  // 1. Get current balance
  const balance = await calculatePocketBalance(pocketId, monthKey);
  const currentBalance = balance.availableBalance;
  
  // 2. Get wishlist items
  const wishlist = await kv.get<WishlistItem[]>(`wishlist:${monthKey}:${pocketId}`) || [];
  const activeItems = wishlist.filter(item => item.status !== 'purchased');
  
  // 3. Sort by priority (1=High first)
  const sortedItems = [...activeItems].sort((a, b) => a.priority - b.priority);
  
  // 4. Calculate totals
  const total = activeItems.reduce((sum, item) => sum + item.amount, 0);
  const byPriority = {
    high: {
      count: activeItems.filter(i => i.priority === 1).length,
      total: activeItems.filter(i => i.priority === 1).reduce((sum, i) => sum + i.amount, 0)
    },
    medium: {
      count: activeItems.filter(i => i.priority === 2).length,
      total: activeItems.filter(i => i.priority === 2).reduce((sum, i) => sum + i.amount, 0)
    },
    low: {
      count: activeItems.filter(i => i.priority === 3).length,
      total: activeItems.filter(i => i.priority === 3).reduce((sum, i) => sum + i.amount, 0)
    }
  };
  
  // 5. Simulate cascading purchases
  let runningBalance = currentBalance;
  const scenarios: SimulationScenario[] = [];
  const affordableNow: string[] = [];
  const affordableSoon: Array<any> = [];
  const notAffordable: string[] = [];
  
  for (const item of sortedItems) {
    const balanceAfter = runningBalance - item.amount;
    let status: SimulationScenario['status'];
    
    if (balanceAfter >= item.amount) {
      // Can buy this and still have money for next item
      status = 'affordable';
      affordableNow.push(item.id);
    } else if (balanceAfter >= 0) {
      // Can buy but will be low/zero
      if (balanceAfter < 500000) {
        status = 'low-balance';
      } else {
        status = 'affordable';
      }
      affordableNow.push(item.id);
    } else {
      // Cannot afford
      status = 'insufficient';
      
      const amountNeeded = item.amount - runningBalance;
      if (amountNeeded < 1000000) {
        // Affordable soon
        affordableSoon.push({
          itemId: item.id,
          amountNeeded,
          estimatedWeeks: Math.ceil(amountNeeded / 250000) // Assume Rp 250k/week income
        });
      } else {
        notAffordable.push(item.id);
      }
    }
    
    // Find which items would be blocked if this is purchased
    const blockedItems: string[] = [];
    if (status === 'affordable' || status === 'low-balance') {
      let tempBalance = balanceAfter;
      for (let j = sortedItems.indexOf(item) + 1; j < sortedItems.length; j++) {
        const nextItem = sortedItems[j];
        if (tempBalance < nextItem.amount) {
          blockedItems.push(nextItem.id);
        }
        tempBalance -= nextItem.amount;
      }
    }
    
    scenarios.push({
      itemId: item.id,
      itemName: item.name,
      amount: item.amount,
      currentBalance: runningBalance,
      balanceAfter,
      status,
      blockedItems,
      warning: balanceAfter < 0 
        ? `Kurang Rp ${Math.abs(balanceAfter).toLocaleString('id-ID')}`
        : balanceAfter < 500000
        ? `Sisa hanya Rp ${balanceAfter.toLocaleString('id-ID')}`
        : undefined
    });
    
    // Update running balance for next iteration
    if (status === 'affordable' || status === 'low-balance') {
      runningBalance = balanceAfter;
    }
  }
  
  // 6. Generate recommendations
  const recommendations = generateRecommendations(
    currentBalance,
    total,
    scenarios,
    affordableNow,
    affordableSoon
  );
  
  // 7. Get pocket info
  const pockets = await getPockets(monthKey);
  const pocket = pockets.find(p => p.id === pocketId);
  
  return {
    pocketId,
    pocketName: pocket?.name || 'Unknown',
    currentBalance,
    wishlist: {
      total,
      count: activeItems.length,
      byPriority
    },
    affordableNow,
    affordableSoon,
    notAffordable,
    scenarios,
    recommendations
  };
}

/**
 * Generate smart recommendations
 */
function generateRecommendations(
  currentBalance: number,
  wishlistTotal: number,
  scenarios: SimulationScenario[],
  affordableNow: string[],
  affordableSoon: Array<any>
): SimulationResult['recommendations'] {
  const recs: SimulationResult['recommendations'] = [];
  
  // Recommendation 1: Overall affordability
  if (currentBalance >= wishlistTotal) {
    recs.push({
      type: 'info',
      message: `âœ… Saldo cukup untuk semua items (Rp ${wishlistTotal.toLocaleString('id-ID')})`,
      actionable: false
    });
  } else {
    const shortage = wishlistTotal - currentBalance;
    recs.push({
      type: 'warning',
      message: `âš ï¸ Kurang Rp ${shortage.toLocaleString('id-ID')} untuk beli semua items`,
      actionable: true,
      action: {
        type: 'save',
        params: { targetAmount: shortage }
      }
    });
  }
  
  // Recommendation 2: Priority suggestions
  if (affordableNow.length > 0 && affordableNow.length < scenarios.length) {
    recs.push({
      type: 'suggestion',
      message: `ğŸ’¡ Bisa beli ${affordableNow.length} item sekarang (prioritas tertinggi)`,
      actionable: true,
      action: {
        type: 'reprioritize',
        params: { affordableIds: affordableNow }
      }
    });
  }
  
  // Recommendation 3: Savings plan for "soon" items
  if (affordableSoon.length > 0) {
    const firstSoon = affordableSoon[0];
    recs.push({
      type: 'suggestion',
      message: `ğŸ’° Transfer Rp ${Math.ceil(firstSoon.amountNeeded / firstSoon.estimatedWeeks).toLocaleString('id-ID')}/minggu untuk beli dalam ${firstSoon.estimatedWeeks} minggu`,
      actionable: true,
      action: {
        type: 'transfer',
        params: {
          amount: Math.ceil(firstSoon.amountNeeded / firstSoon.estimatedWeeks),
          frequency: 'weekly'
        }
      }
    });
  }
  
  // Recommendation 4: Balance warning
  const firstScenario = scenarios.find(s => s.status === 'low-balance');
  if (firstScenario) {
    recs.push({
      type: 'warning',
      message: `âš ï¸ Jika beli "${firstScenario.itemName}", sisa hanya Rp ${firstScenario.balanceAfter.toLocaleString('id-ID')}`,
      actionable: false
    });
  }
  
  return recs;
}
```

### Convert Wishlist to Expense

```typescript
/**
 * Mark wishlist item as purchased
 * Creates expense and updates wishlist status
 */
async function purchaseWishlistItem(
  itemId: string,
  pocketId: string,
  monthKey: string,
  purchaseDate?: string
): Promise<{ expense: Expense; updatedItem: WishlistItem }> {
  // 1. Get wishlist item
  const wishlist = await kv.get<WishlistItem[]>(`wishlist:${monthKey}:${pocketId}`) || [];
  const item = wishlist.find(i => i.id === itemId);
  
  if (!item) {
    throw new Error('Wishlist item not found');
  }
  
  if (item.status === 'purchased') {
    throw new Error('Item already purchased');
  }
  
  // 2. Create expense
  const expense: Expense = {
    id: `expense_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    name: item.name,
    amount: item.amount,
    date: purchaseDate || new Date().toISOString(),
    pocketId: pocketId,
    createdAt: new Date().toISOString(),
    metadata: {
      fromWishlist: true,
      wishlistItemId: item.id,
      wishlistPriority: item.priority
    }
  };
  
  // 3. Save expense
  const expenses = await kv.get<Expense[]>(`expenses:${monthKey}`) || [];
  expenses.push(expense);
  await kv.set(`expenses:${monthKey}`, expenses);
  
  // 4. Update wishlist item status
  item.status = 'purchased';
  item.purchasedAt = expense.date;
  item.purchasedExpenseId = expense.id;
  item.updatedAt = new Date().toISOString();
  
  const updatedWishlist = wishlist.map(i => i.id === itemId ? item : i);
  await kv.set(`wishlist:${monthKey}:${pocketId}`, updatedWishlist);
  
  return { expense, updatedItem: item };
}
```

---

## UI/UX Design

### Wishlist View (Separate Page/Tab)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ Simulasi Budget - Kantong Uang Dingin            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ Saldo Tersedia: Rp 2.000.000                        â”‚
â”‚ Total Wishlist: Rp 2.800.000 (3 items)              â”‚
â”‚ Status: âš ï¸ Kurang Rp 800.000                        â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ’¡ Rekomendasi:                                  â”‚ â”‚
â”‚ â”‚ â€¢ âœ… Bisa beli 2 item sekarang (prioritas tinggi)â”‚ â”‚
â”‚ â”‚ â€¢ ğŸ’° Transfer Rp 200k/minggu untuk beli semua    â”‚ â”‚
â”‚ â”‚   dalam 4 minggu                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ WISHLIST ITEMS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ â­ HIGH PRIORITY (2 items - Rp 1.800.000)          â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜ ğŸ® Gaming Console      Rp 800.000             â”‚ â”‚
â”‚ â”‚    Target: 15 Nov 2025                          â”‚ â”‚
â”‚ â”‚    âœ… Cukup! Sisa Rp 1.200.000                  â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚    [ğŸ‘ï¸ Preview] [âœ“ Beli Sekarang] [Edit] [ğŸ—‘]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜ ğŸ§ Headset Gaming       Rp 1.000.000          â”‚ â”‚
â”‚ â”‚    Target: 20 Nov 2025                          â”‚ â”‚
â”‚ â”‚    âš ï¸  Jika beli, sisa Rp 200.000 (rendah)      â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚    [ğŸ‘ï¸ Preview] [âœ“ Beli] [Edit] [ğŸ—‘]            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ â­â­ MEDIUM PRIORITY (1 item - Rp 500.000)          â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜ âŒ¨ï¸  Mechanical Keyboard  Rp 500.000           â”‚ â”‚
â”‚ â”‚    No target date                               â”‚ â”‚
â”‚ â”‚    âŒ Kurang Rp 300.000                         â”‚ â”‚
â”‚ â”‚    ğŸ’¡ Bisa beli dalam ~2 minggu                 â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚    [ğŸ“Š Savings Plan] [Edit] [ğŸ—‘]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ â­â­â­ LOW PRIORITY (0 items)                        â”‚
â”‚                                                      â”‚
â”‚ [+ Tambah Item ke Wishlist]                          â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Preview Simulation Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preview Simulation              [X]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Item: ğŸ® Gaming Console                  â”‚
â”‚ Harga: Rp 800.000                        â”‚
â”‚                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                          â”‚
â”‚ ğŸ’° Current State:                        â”‚
â”‚ Saldo Sekarang: Rp 2.000.000            â”‚
â”‚                                          â”‚
â”‚ ğŸ”® After Purchase:                       â”‚
â”‚ Saldo Tersisa: Rp 1.200.000 âœ…          â”‚
â”‚ Status: Safe (masih banyak)              â”‚
â”‚                                          â”‚
â”‚ âš ï¸  Impact:                              â”‚
â”‚ â€¢ Item lain yang terpengaruh:            â”‚
â”‚   - Headset Gaming: Masih bisa (sisa    â”‚
â”‚     Rp 200k setelah beli keduanya)      â”‚
â”‚   - Keyboard: Tidak bisa lagi           â”‚
â”‚                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                          â”‚
â”‚ [Batal]           [Lanjut Beli]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Add Wishlist Item Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tambah ke Wishlist              [X]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Nama Item                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Gaming Console PS5                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ Harga                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 800000                             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ Prioritas                                â”‚
â”‚ âšª High  âšª Medium  âšª Low                â”‚
â”‚                                          â”‚
â”‚ Kantong                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Uang Dingin                    â–¼â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ Saldo tersedia: Rp 2.000.000 âœ…         â”‚
â”‚                                          â”‚
â”‚ Target Tanggal (opsional)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸ“… 15 November 2025                â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ Link Produk (opsional)                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ https://tokopedia.com/...          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ Catatan (opsional)                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Black Friday sale                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Batal]            [Tambah]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Savings Plan Generator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Buat Savings Plan               [X]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Item: âŒ¨ï¸ Mechanical Keyboard             â”‚
â”‚ Harga: Rp 500.000                        â”‚
â”‚                                          â”‚
â”‚ Saldo Sekarang: Rp 200.000              â”‚
â”‚ Perlu: Rp 300.000                        â”‚
â”‚                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                          â”‚
â”‚ Pilih Strategi Saving:                   â”‚
â”‚                                          â”‚
â”‚ âšª Aggressive (1 minggu)                 â”‚
â”‚    Transfer: Rp 300.000 sekali          â”‚
â”‚                                          â”‚
â”‚ âšª Balanced (2 minggu) â­ Recommended    â”‚
â”‚    Transfer: Rp 150.000/minggu          â”‚
â”‚                                          â”‚
â”‚ âšª Relaxed (4 minggu)                    â”‚
â”‚    Transfer: Rp 75.000/minggu           â”‚
â”‚                                          â”‚
â”‚ âšª Custom                                 â”‚
â”‚    Transfer: [______]/minggu            â”‚
â”‚    Selesai dalam: __ minggu             â”‚
â”‚                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                          â”‚
â”‚ Transfer dari kantong:                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Sehari-hari                    â–¼â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ â˜‘ Enable auto-transfer                  â”‚
â”‚   (Otomatis transfer tiap minggu)       â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Batal]      [Buat Plan & Auto-Transfer] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Access from Pockets Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘› Sehari-hari                          â”‚
â”‚ Budget untuk kebutuhan sehari-hari      â”‚
â”‚                                         â”‚
â”‚ Saldo Tersedia    Rp 11.150.000        â”‚
â”‚                                         â”‚
â”‚ ğŸ¯ Wishlist (0 items)                  â”‚
â”‚ [Lihat Simulasi]                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ¨ Uang Dingin                          â”‚
â”‚ Dana untuk hobi dan hiburan             â”‚
â”‚                                         â”‚
â”‚ Saldo Tersedia    Rp 2.000.000         â”‚
â”‚                                         â”‚
â”‚ ğŸ¯ Wishlist (3 items - Rp 2.8jt)       â”‚
â”‚ âš ï¸ Kurang Rp 800k                      â”‚
â”‚ [Lihat Simulasi]                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoints

```typescript
// Wishlist CRUD
GET    /wishlist?monthKey=xxx&pocketId=xxx
POST   /wishlist
PUT    /wishlist/:id
DELETE /wishlist/:id

// Simulation
GET    /wishlist/simulate?monthKey=xxx&pocketId=xxx
POST   /wishlist/simulate/custom
       Body: { balance, items: [...] }

// Purchase
POST   /wishlist/:id/purchase
       Body: { monthKey, date? }
       
// Savings Plan
POST   /wishlist/:id/savings-plan
       Body: { strategy, frequency, autoTransfer }
GET    /savings-plans

// Bulk operations
POST   /wishlist/reorder
       Body: { items: [{ id, priority, order }] }
DELETE /wishlist/clear-purchased?monthKey=xxx&pocketId=xxx
```

---

## Integration Points

### With Expenses
- Convert wishlist â†’ expense (one click)
- Expense retains wishlist metadata
- Can filter expenses by "from wishlist"

### With Transfers
- Savings plan â†’ auto-transfer rule
- Transfer suggestions based on wishlist

### With Timeline
- Future timeline view with wishlist items (planned)
- Show "if purchased" in timeline preview

### With Carry Over
- Wishlist carries over to next month (status: saving)
- Adjust simulation with carry over balance

---

## Advanced Features (Future)

### Price Tracking
```typescript
interface PriceHistory {
  itemId: string;
  prices: Array<{
    date: string;
    amount: number;
    source: string; // URL
  }>;
  lowestPrice: number;
  highestPrice: number;
  averagePrice: number;
  priceTrend: 'up' | 'down' | 'stable';
}

// Notification when price drops
```

### Shared Wishlist
```typescript
// Family/couple wishlist
interface SharedWishlist {
  items: WishlistItem[];
  sharedWith: string[]; // userIds
  contributionTracking: Map<string, number>;
}
```

### Smart Suggestions
```typescript
// AI-powered suggestions based on:
// - Spending patterns
// - Season/holidays
// - Price trends
// - Similar users
```

---

## Implementation Priority

### Phase 1.5 (Essential):
1. âœ… Carry Over per Kantong
2. âœ… Archive Kantong (dengan balance = 0 requirement)

### Phase 2.1:
3. âœ… Basic Wishlist (add, edit, delete)
4. âœ… Simple Simulation (affordable vs not)

### Phase 2.2:
5. âœ… Advanced Simulation (cascading, recommendations)
6. âœ… Convert wishlist to expense
7. âœ… Savings plan generator

### Phase 2.3:
8. âœ… Auto-transfer from savings plan
9. âœ… Integration with timeline
10. âœ… Price tracking (future)

---

**Version**: 1.0  
**Last Updated**: November 5, 2025  
**Status**: Ready for Implementation Planning
