# ğŸ¨ VISUAL ARCHITECTURE - Kantong Architecture Fix V3

**Visual diagrams untuk memahami perubahan arsitektur**

---

## ğŸ“Š BEFORE vs AFTER OVERVIEW

### **âŒ BEFORE (Current - Broken):**

```
November 2025                          December 2025
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Sehari-hari          â”‚           â”‚ ğŸ’° Sehari-hari          â”‚
â”‚ â„ï¸  Uang Dingin         â”‚           â”‚ â„ï¸  Uang Dingin         â”‚
â”‚ ğŸ“ˆ Investasi (custom)   â”‚           â”‚ âŒ Investasi HILANG!    â”‚
â”‚                         â”‚           â”‚                         â”‚
â”‚ Saldo:                  â”‚           â”‚ Saldo:                  â”‚
â”‚ - Sehari-hari: 200K     â”‚   âŒ â†’    â”‚ - Sehari-hari: 0        â”‚
â”‚ - Uang Dingin: 500K     â”‚           â”‚ - Uang Dingin: 0        â”‚
â”‚ - Investasi: 1M         â”‚           â”‚ - Investasi: GONE       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Problems:
1. Custom pocket "Investasi" HILANG
2. Saldo reset ke 0 (harusnya carry-over)
3. Timeline campur (Nov + Dec)
```

### **âœ… AFTER (Fixed):**

```
November 2025                          December 2025
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Sehari-hari          â”‚           â”‚ ğŸ’° Sehari-hari          â”‚
â”‚ â„ï¸  Uang Dingin         â”‚           â”‚ â„ï¸  Uang Dingin         â”‚
â”‚ ğŸ“ˆ Investasi (custom)   â”‚           â”‚ ğŸ“ˆ Investasi âœ… ADA!    â”‚
â”‚                         â”‚           â”‚                         â”‚
â”‚ Saldo:                  â”‚           â”‚ Saldo Awal (carry-over):â”‚
â”‚ - Sehari-hari: 200K     â”‚   âœ… â†’    â”‚ - Sehari-hari: 3.4M     â”‚
â”‚ - Uang Dingin: 500K     â”‚           â”‚   (200K + 3.2M budget)  â”‚
â”‚ - Investasi: 1M         â”‚           â”‚ - Uang Dingin: 500K     â”‚
â”‚                         â”‚           â”‚ - Investasi: 1M         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Solutions:
1. Custom pocket PERMANEN (global registry)
2. Saldo carry-over OTOMATIS per tipe
3. Timeline filter PER BULAN + Saldo Awal
```

---

## ğŸ—‚ï¸ DATA STORAGE ARCHITECTURE

### **FASE 1: Pocket Storage Change**

#### **âŒ OLD (Per-Month Storage):**

```
KV Store:
â”œâ”€â”€ pocket:2025-11:pocket_daily          â†’ "Sehari-hari"
â”œâ”€â”€ pocket:2025-11:pocket_cold_money     â†’ "Uang Dingin"
â”œâ”€â”€ pocket:2025-11:custom_abc123         â†’ "Investasi"
â”‚
â”œâ”€â”€ pocket:2025-12:pocket_daily          â†’ "Sehari-hari"
â”œâ”€â”€ pocket:2025-12:pocket_cold_money     â†’ "Uang Dingin"
â””â”€â”€ pocket:2025-12:custom_abc123         â†’ âŒ TIDAK ADA! (Hilang)

Problem: Setiap bulan = storage baru â†’ custom pockets hilang
```

#### **âœ… NEW (Global Registry):**

```
KV Store:
â”œâ”€â”€ pocket:global:pocket_daily           â†’ "Sehari-hari" âœ… PERMANEN
â”œâ”€â”€ pocket:global:pocket_cold_money      â†’ "Uang Dingin" âœ… PERMANEN
â”œâ”€â”€ pocket:global:custom_abc123          â†’ "Investasi"   âœ… PERMANEN
â”‚
â”œâ”€â”€ carryover:2025-12:pocket_daily       â†’ Carry-over data
â”œâ”€â”€ carryover:2025-12:pocket_cold_money  â†’ Carry-over data
â””â”€â”€ carryover:2025-12:custom_abc123      â†’ Carry-over data

Solution: Global registry â†’ pockets TIDAK terikat bulan
```

---

## ğŸ’° CARRY-OVER LOGIC FLOW

### **FASE 2: Calculation Logic Per Pocket Type**

#### **Tipe 1: Sehari-hari (Zero-Based Budgeting)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NOVEMBER 2025                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Budget Awal:        Rp 3.000.000                        â”‚
â”‚ Pengeluaran:        Rp 2.800.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp   200.000  â†’ Carry-over          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Auto-generated on
                            â”‚ Dec 1st access
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DECEMBER 2025                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Carry-over Nov:     Rp   200.000  âœ…                    â”‚
â”‚ Budget Baru Dec:    Rp 3.200.000  âœ… (user input)       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SALDO AWAL:         Rp 3.400.000  â† Zero-Based Budget   â”‚
â”‚                                                          â”‚
â”‚ Pengeluaran Dec:    Rp 1.500.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp 1.900.000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Formula: Saldo Awal Des = Carry-over + Budget Baru
```

#### **Tipe 2: Uang Dingin (Simple Carry-Over)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NOVEMBER 2025                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Income (USD):       Rp 1.000.000                        â”‚
â”‚ Pengeluaran:        Rp   500.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp   500.000  â†’ Carry-over          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Auto-generated
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DECEMBER 2025                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SALDO AWAL:         Rp   500.000  â† Simple Carry-Over   â”‚
â”‚                                                          â”‚
â”‚ Income Dec (USD):   Rp   200.000 (+)                    â”‚
â”‚ Pengeluaran Dec:    Rp   100.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp   600.000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Formula: Saldo Awal Des = Saldo Akhir Nov
```

#### **Tipe 3: Custom Pockets (Simple Carry-Over)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          NOVEMBER 2025 - Kantong "Investasi"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Income:             Rp 1.500.000                        â”‚
â”‚ Transfer In:        Rp   500.000 (+)                    â”‚
â”‚ Pengeluaran:        Rp 1.000.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp 1.000.000  â†’ Carry-over          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Auto-generated
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DECEMBER 2025 - Kantong "Investasi"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SALDO AWAL:         Rp 1.000.000  â† Simple Carry-Over   â”‚
â”‚                                                          â”‚
â”‚ Income Dec:         Rp   300.000 (+)                    â”‚
â”‚ Pengeluaran Dec:    Rp   200.000 (-)                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚ SISA SALDO:         Rp 1.100.000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Formula: Saldo Awal Des = Saldo Akhir Nov
```

---

## ğŸ“… TIMELINE FILTERING

### **FASE 3: Month-Specific Timeline**

#### **âŒ OLD (No Filter - Campur Semua Bulan):**

```
Timeline "Uang Dingin" (opened in December):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… Oktober 2025                            â”‚
â”‚ â”œâ”€ 5 Oct: Income $100                     â”‚
â”‚ â”œâ”€ 10 Oct: Expense -Rp 50K                â”‚
â”‚                                             â”‚
â”‚ ğŸ“… November 2025                           â”‚
â”‚ â”œâ”€ 3 Nov: Income $150                     â”‚
â”‚ â”œâ”€ 15 Nov: Expense -Rp 100K               â”‚
â”‚                                             â”‚
â”‚ ğŸ“… December 2025                           â”‚
â”‚ â”œâ”€ 1 Dec: Income $200                     â”‚
â”‚ â”œâ”€ 8 Dec: Expense -Rp 75K                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Problem: User bingung - mana transaksi December?
```

#### **âœ… NEW (Filtered + Saldo Awal):**

```
Timeline "Uang Dingin" (opened in December):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Saldo Awal (Carry-over dari Nov)       â”‚
â”‚    +Rp 500.000                             â”‚
â”‚    Balance: Rp 500.000                     â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                             â”‚
â”‚ ğŸ“… December 2025 Transactions:            â”‚
â”‚                                             â”‚
â”‚ â”œâ”€ 1 Dec: Income $200 â†’ +Rp 3.100.000     â”‚
â”‚ â”‚  Balance: Rp 3.600.000                  â”‚
â”‚                                             â”‚
â”‚ â”œâ”€ 5 Dec: Expense -Rp 100.000             â”‚
â”‚ â”‚  Balance: Rp 3.500.000                  â”‚
â”‚                                             â”‚
â”‚ â”œâ”€ 8 Dec: Transfer to Investasi -Rp 200K  â”‚
â”‚ â”‚  Balance: Rp 3.300.000                  â”‚
â”‚                                             â”‚
â”‚ â””â”€ 10 Dec: Expense -Rp 75.000             â”‚
â”‚    Balance: Rp 3.225.000                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Solution: Clean, filtered, dengan saldo awal jelas
```

---

## ğŸ”„ MONTH TRANSITION FLOW

### **Auto Carry-Over Generation:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Navigate to December (first time)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Check if carry-over exists for Dec 2025       â”‚
â”‚ Query: kv.getByPrefix('carryover:2025-12:')            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â”€â”€ Found? â”€â”€â”€ YES â”€â”€â†’ Use existing data âœ…
                  â”‚
                  â””â”€â”€â”€ NO? â”€â”€â”€ Auto-generate!
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUTO-GENERATION PROCESS:                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Fetch all active pockets                            â”‚
â”‚    â†’ pocket_daily, pocket_cold_money, custom_abc123    â”‚
â”‚                                                          â”‚
â”‚ 2. For each pocket:                                     â”‚
â”‚    a. Calculate Nov balance (final)                    â”‚
â”‚    b. Create carry-over entry                          â”‚
â”‚    c. Save to: carryover:2025-12:{pocketId}            â”‚
â”‚                                                          â”‚
â”‚ 3. Example carry-over:                                 â”‚
â”‚    {                                                    â”‚
â”‚      id: "carryover_2025-12_pocket_cold_money",        â”‚
â”‚      pocketId: "pocket_cold_money",                    â”‚
â”‚      fromMonth: "2025-11",                             â”‚
â”‚      toMonth: "2025-12",                               â”‚
â”‚      amount: 500000,                                   â”‚
â”‚      breakdown: {                                      â”‚
â”‚        originalAmount: 1000000,                        â”‚
â”‚        expenses: 500000                                â”‚
â”‚      }                                                  â”‚
â”‚    }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULT: December data ready!                           â”‚
â”‚ - Pockets visible âœ…                                    â”‚
â”‚ - Saldo awal calculated âœ…                              â”‚
â”‚ - Timeline shows carry-over âœ…                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ SYSTEM ARCHITECTURE DIAGRAM

### **Complete Data Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (React)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ MonthSelectorâ”‚  â”‚ PocketsSummaryâ”‚  â”‚PocketTimelineâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                 â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                           â”‚                                 â”‚
â”‚                    usePockets() hook                        â”‚
â”‚                           â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                  HTTP API Calls
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 BACKEND (Supabase Edge Function)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  API Endpoints:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GET  /pockets/:year/:month                          â”‚   â”‚
â”‚  â”‚      â†’ Fetch from global registry                   â”‚   â”‚
â”‚  â”‚      â†’ Auto-generate carry-over if needed           â”‚   â”‚
â”‚  â”‚      â†’ Calculate balances per pocket                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ POST /pockets/:year/:month                          â”‚   â”‚
â”‚  â”‚      â†’ Save to global registry                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ GET  /timeline/:pocketId/:year/:month               â”‚   â”‚
â”‚  â”‚      â†’ Filter transactions by month                 â”‚   â”‚
â”‚  â”‚      â†’ Add "Saldo Awal" entry                       â”‚   â”‚
â”‚  â”‚      â†’ Calculate running balance                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚              Database Access Layer                          â”‚
â”‚                           â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Supabase KV Store)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Global Pocket Registry:                                    â”‚
â”‚  â”œâ”€â”€ pocket:global:pocket_daily          âœ… PERMANEN        â”‚
â”‚  â”œâ”€â”€ pocket:global:pocket_cold_money     âœ… PERMANEN        â”‚
â”‚  â””â”€â”€ pocket:global:custom_*              âœ… PERMANEN        â”‚
â”‚                                                              â”‚
â”‚  Carry-Over Data (Per Month):                               â”‚
â”‚  â”œâ”€â”€ carryover:2025-12:pocket_daily                         â”‚
â”‚  â”œâ”€â”€ carryover:2025-12:pocket_cold_money                    â”‚
â”‚  â””â”€â”€ carryover:2025-12:custom_*                             â”‚
â”‚                                                              â”‚
â”‚  Transactions (Per Month):                                  â”‚
â”‚  â”œâ”€â”€ expense:2025-12:*                                      â”‚
â”‚  â”œâ”€â”€ income:2025-12:*                                       â”‚
â”‚  â””â”€â”€ transfer:2025-12:*                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ STATE TRANSITIONS

### **Pocket Lifecycle:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CREATED    â”‚ â† User creates pocket (Nov)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Saved to: pocket:global:{id}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ACTIVE    â”‚ â† Visible in Nov, Dec, Jan, ...
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User archives pocket
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ARCHIVED   â”‚ â† Not visible, but data preserved
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User unarchives
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ACTIVE    â”‚ â† Back to active list
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key: Pocket NEVER truly deleted (unless explicit delete)
     Status field controls visibility
```

### **Balance Lifecycle:**

```
End of November:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Final Balance: 500K  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Auto-trigger on Dec 1st access
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate Carry-Over â”‚
â”‚  Amount: 500K        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Save to: carryover:2025-12:pocket_id
       â–¼
Start of December:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Saldo Awal: 500K     â”‚ â† Used in calculatePocketBalance()
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ + Income Dec
       â”‚ - Expense Dec
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Final Balance: 600K  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Cycle repeats for January...
       â–¼
```

---

## ğŸ¯ VISUAL VERIFICATION GUIDE

### **How to Verify Each Phase:**

#### **FASE 1 Verification:**

```
TEST: Create pocket in Nov â†’ Check Dec

November:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create "Investasi" ğŸ“ˆ   â”‚
â”‚ Status: âœ… Created      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Navigate to December â†“

December:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check pockets list      â”‚
â”‚ "Investasi" ğŸ“ˆ          â”‚
â”‚ Status: âœ… STILL HERE!  â”‚ â† SUCCESS!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ FAIL: If "Investasi" tidak muncul
âœ… PASS: If "Investasi" masih ada
```

#### **FASE 2 Verification:**

```
TEST: Saldo carry-over akurat

November:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Uang Dingin:            â”‚
â”‚ Income: Rp 1M           â”‚
â”‚ Expense: Rp 500K        â”‚
â”‚ Final: Rp 500K âœ…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Navigate to December â†“

December:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Uang Dingin:            â”‚
â”‚ Saldo Awal: Rp 500K âœ…  â”‚ â† Should match Nov final
â”‚ (Not Rp 0!)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ FAIL: If Saldo Awal = Rp 0
âœ… PASS: If Saldo Awal = Rp 500K
```

#### **FASE 3 Verification:**

```
TEST: Timeline filter + Saldo Awal

November: Create 5 expenses
December: Create 3 expenses

Open Timeline in December â†“

Timeline Display:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Saldo Awal +500K âœ…  â”‚ â† Top entry
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ 1 Dec: Expense âœ…       â”‚ â† Only Dec
â”‚ 5 Dec: Income âœ…        â”‚ â† Only Dec
â”‚ 8 Dec: Expense âœ…       â”‚ â† Only Dec
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ (No Nov data) âœ…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ FAIL: If Nov data appears or no "Saldo Awal"
âœ… PASS: If only Dec + "Saldo Awal"
```

---

## ğŸ“Š PERFORMANCE IMPACT

### **Query Optimization:**

```
OLD (Per-Month):
â”œâ”€â”€ Query 1: getByPrefix('pocket:2025-12:')  â†’ 3 pockets
â”œâ”€â”€ Query 2: Calculate balance (3 queries)
â””â”€â”€ Total: 4 queries

NEW (Global):
â”œâ”€â”€ Query 1: getByPrefix('pocket:global:')    â†’ 3 pockets (cached)
â”œâ”€â”€ Query 2: getByPrefix('carryover:2025-12:')â†’ 3 carry-overs
â”œâ”€â”€ Query 3: Calculate balance (parallel)
â””â”€â”€ Total: 3 queries (with caching)

Performance: ~15% faster (with caching)
```

---

## ğŸ¨ UI/UX CHANGES

### **Timeline "Saldo Awal" Entry:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ ğŸ’°  â”‚  Saldo Awal (Carry-over dari November)   â”‚
â”‚  â”‚ Blueâ”‚  +Rp 500.000                              â”‚
â”‚  â”‚ BG  â”‚  Carry-over: Rp 500K + Budget: Rp 0      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  Saldo: Rp 500.000                       â”‚
â”‚                                                     â”‚
â”‚  [Badge: Saldo Awal] â† Blue badge                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Special styling:
- Blue gradient background
- Larger icon
- Badge "Saldo Awal"
- Breakdown (for Tipe 1)
- Always at top of list
```

---

**For complete implementation details, see [PLANNING.md](./PLANNING.md)**

**Last Updated:** November 9, 2025  
**Status:** ğŸ“‹ PLANNING COMPLETE
